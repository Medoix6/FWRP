(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[287],{3385:(e,a,s)=>{Promise.resolve().then(s.bind(s,2043))},2043:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>k});var t=s(5155),r=s(2115),l=s(6046),i=s(3312),n=s(3900),d=s(8986),o=s(6754),c=s(5055),u=s(7936),m=s(2472),h=s(3474),x=s(9962),f=s(7493),p=s(7433),g=s(1354),b=s(1598),v=s(8173),y=s.n(v),j=s(9949),w=s(399),N=s(7058);async function C(e){let a=await (0,N.x7)((0,N.H9)(j.db,"users",e));return a.exists()?a.data():null}async function P(e,a){await (0,N.mZ)((0,N.H9)(j.db,"users",e),a)}function k(){let e=(0,l.useRouter)(),[a,s]=(0,r.useState)(!1),[v,N]=(0,r.useState)({displayName:null,email:null}),[k,S]=(0,r.useState)(!1),[F,A]=(0,r.useState)(null),[E,q]=(0,r.useState)(!1),[U]=(0,r.useState)(!0),[$,_]=(0,r.useState)(!1),[J,O]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=(0,w.hg)(j.j,async e=>{if(e){N({displayName:e.displayName||"No Username",email:e.email||"No Email"});let a=await C(e.uid);a?(D({fullName:a.name||"",email:a.email||"",phone:a.phone||"",address:a.address||"",city:a.city||"",state:a.state||"",postalCode:a.postalCode||"",bio:a.bio||"",avatar:a.avatar||""}),A(!!a.isAdmin)):A(!1)}else A(!1),window.location.href="/login"});return()=>e()},[]);let[z,D]=(0,r.useState)({fullName:"",email:"",phone:"",address:"",city:"",state:"",postalCode:"",bio:"",avatar:""}),[R,I]=(0,r.useState)(!1),[B,T]=(0,r.useState)(null),K=e=>{let{name:a,value:s}=e.target;D(e=>({...e,[a]:s}))},W=async()=>{D(e=>({...e,avatar:""}));try{let e=j.j.currentUser;if(!e)throw Error("No authenticated user");await P(e.uid,{avatar:""}),T(null)}catch(e){T("Failed to reset avatar in database.")}},Z=async a=>{if(!k){a.preventDefault(),S(!0);return}a.preventDefault(),I(!0),T(null);try{let a=j.j.currentUser;if(!a)throw Error("No authenticated user");let s=z.avatar;await P(a.uid,{name:z.fullName,email:z.email,phone:z.phone,address:z.address,city:z.city,state:z.state,postalCode:z.postalCode,bio:z.bio,avatar:s}),D(e=>({...e,avatar:s})),S(!1),F?e.push("/admin"):e.push("/dashboard")}catch(e){console.error("Error updating profile:",e),T((null==e?void 0:e.message)||"Failed to update profile. Please try again.")}finally{I(!1)}},[H,L]=(0,r.useState)(!1),[G,V]=(0,r.useState)(""),[Q,X]=(0,r.useState)(""),[Y,M]=(0,r.useState)(null),[ee,ea]=(0,r.useState)(null),[es,et]=(0,r.useState)(!1),er=e=>/^(?=.*[A-Z])(?=.*\d)[A-Za-z\d]{6,}$/.test(e),el=async e=>{if(e.preventDefault(),M(null),ea(null),et(!0),!er(Q)){M("Password must be at least 6 characters, include 1 capital letter and 1 number."),et(!1);return}try{let e=j.j.currentUser;if(!e||!e.email)throw Error("No authenticated user");let a=w.IX.credential(e.email,G);await (0,w.kZ)(e,a),await (0,w.f3)(e,Q),ea("Password updated successfully."),L(!1),V(""),X("")}catch(e){if("object"==typeof e&&null!==e&&("code"in e||"message"in e)){let a=e.code,s=e.message;"auth/invalid-credential"===a||"string"==typeof s&&s.includes("auth/invalid-credential")?M("The current password you entered is incorrect."):M(s||"Failed to update password.")}else M("Failed to update password.")}finally{et(!1)}};return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-100 flex",children:[(0,t.jsx)("div",{className:"lg:hidden fixed top-4 left-4 z-50",children:(0,t.jsx)(i.$,{variant:"outline",size:"icon",onClick:()=>s(!a),className:"bg-white",children:(0,t.jsx)(u.A,{className:"h-5 w-5"})})}),(0,t.jsx)("div",{className:"\n        fixed inset-y-0 left-0 z-40 w-64 bg-white shadow-lg transform transition-transform duration-300 ease-in-out\n        ".concat(a?"translate-x-0":"-translate-x-full"," lg:translate-x-0\n      "),children:(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsx)("div",{className:"p-6 border-b",children:(0,t.jsx)("h2",{className:"text-2xl font-bold text-green-600",children:"FWRP"})}),(0,t.jsxs)("div",{className:"flex-1 py-6 px-4 space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center mb-8",children:[(0,t.jsxs)(c.eu,{className:"w-24 h-24 mb-2",children:[(0,t.jsx)(c.BK,{src:z.avatar||"/placeholder.svg?height=80&width=80",alt:"Profile"}),(0,t.jsx)(c.q5,{children:(0,t.jsx)(m.A,{className:"h-10 w-10"})})]}),(0,t.jsx)("span",{className:"text-lg font-semibold",children:z.fullName||v.displayName})]}),(0,t.jsx)("nav",{className:"mt-8 space-y-2",children:null===F?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(y(),{href:"/edit-profile",className:"flex items-center p-3 bg-gray-100 text-green-600 rounded-md",children:[(0,t.jsx)(h.A,{className:"h-5 w-5 mr-3"}),"Show Profile"]}),F?(0,t.jsxs)(y(),{href:"/admin",className:"flex items-center p-3 text-gray-700 rounded-md hover:bg-gray-100",children:[(0,t.jsx)(x.A,{className:"h-5 w-5 mr-3"}),"Admin Dashboard"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(y(),{href:"/dashboard",className:"flex items-center p-3 text-gray-700 rounded-md hover:bg-gray-100",children:[(0,t.jsx)(f.A,{className:"h-5 w-5 mr-3"}),"Dashboard"]}),(0,t.jsxs)(y(),{href:"/donate-food",className:"flex items-center p-3 text-gray-700 rounded-md hover:bg-gray-100",children:[(0,t.jsx)(p.A,{className:"h-5 w-5 mr-3"}),"Donate Food"]})]})]})})]}),(0,t.jsx)("div",{className:"p-4 border-t",children:(0,t.jsxs)(i.$,{variant:"outline",className:"w-full justify-start",onClick:async()=>{try{await j.j.signOut(),e.push("/login")}catch(e){T("Failed to sign out. Please try again.")}},children:[(0,t.jsx)(g.A,{className:"h-5 w-5 mr-3"}),"Sign out"]})})]})}),(0,t.jsxs)("div",{className:"flex-1 lg:ml-64",children:[(0,t.jsx)("header",{className:"bg-white shadow",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center",children:[(0,t.jsx)(y(),{href:"/dashboard",className:"mr-4",children:(0,t.jsxs)(i.$,{variant:"ghost",size:"sm",children:[(0,t.jsx)(b.A,{className:"h-5 w-5 mr-2"}),"Back to Dashboard"]})}),(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Show Profile"})]})}),(0,t.jsx)("main",{className:"max-w-3xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:(0,t.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-6",children:"Personal Information"}),(0,t.jsxs)("form",{onSubmit:Z,className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(d.J,{htmlFor:"avatar",children:"Profile Picture"}),(0,t.jsxs)("div",{className:"mt-1 flex items-center space-x-5",children:[(0,t.jsxs)(c.eu,{className:"h-20 w-20",children:[(0,t.jsx)(c.BK,{src:z.avatar||"/placeholder.svg?height=80&width=80",alt:"Profile"}),(0,t.jsx)(c.q5,{children:(0,t.jsx)(m.A,{className:"h-10 w-10"})})]}),k&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.$,{type:"button",onClick:()=>{window.cloudinary?(_(!0),O(null),T(null),window.cloudinary.createUploadWidget({cloudName:"drig5ndvt",uploadPreset:"avatar_upload",cropping:!0,multiple:!1,folder:"avatars"},async(e,a)=>{if(!e&&a&&"object"==typeof a&&null!==a&&"success"===a.event){var s;let e=a.info,t=(null!==(s=null==e?void 0:e.secure_url)&&void 0!==s?s:"")+"?t="+Date.now();D(e=>({...e,avatar:t}));try{let e=j.j.currentUser;if(!e)throw Error("No authenticated user");await P(e.uid,{avatar:t}),T(null),O("Avatar updated successfully!")}catch(e){T("Failed to update avatar in database.")}}else e&&T("Cloudinary upload failed. Please try again.");q(!1),_(!1)}).open(),q(!0)):T("Cloudinary widget failed to load. Please try again later.")},className:"ml-4 bg-blue-600 text-white",disabled:!U||$,title:U?"Upload Avatar":"Cloudinary widget is not ready yet",children:$?(0,t.jsxs)("span",{className:"flex items-center",children:[(0,t.jsx)("span",{className:"animate-spin mr-2 h-4 w-4 border-b-2 border-white rounded-full"}),"Uploading..."]}):"Upload Avatar"}),(0,t.jsx)(i.$,{type:"button",onClick:W,className:"ml-2 bg-gray-200 text-gray-800",disabled:$,children:"Reset Avatar"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(d.J,{htmlFor:"fullName",children:"Full Name"}),(0,t.jsx)(n.p,{id:"fullName",name:"fullName",value:z.fullName,onChange:K,required:!0,readOnly:!k})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.J,{htmlFor:"email",children:"Email Address"}),(0,t.jsx)(n.p,{id:"email",name:"email",type:"email",value:z.email,onChange:K,required:!0,readOnly:!k})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.J,{htmlFor:"phone",children:"Phone Number"}),(0,t.jsx)(n.p,{id:"phone",name:"phone",value:z.phone,onChange:K,required:!0,readOnly:!k})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.J,{htmlFor:"address",children:"Address"}),(0,t.jsx)(n.p,{id:"address",name:"address",value:z.address,onChange:K,required:!0,readOnly:!k})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.J,{htmlFor:"city",children:"City"}),(0,t.jsx)(n.p,{id:"city",name:"city",value:z.city,onChange:K,required:!0,readOnly:!k})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.J,{htmlFor:"state",children:"State/Province"}),(0,t.jsx)(n.p,{id:"state",name:"state",value:z.state,onChange:K,required:!0,readOnly:!k})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.J,{htmlFor:"postalCode",children:"Postal Code"}),(0,t.jsx)(n.p,{id:"postalCode",name:"postalCode",value:z.postalCode,onChange:K,required:!0,readOnly:!k})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.J,{htmlFor:"bio",children:"Bio"}),(0,t.jsx)(o.T,{id:"bio",name:"bio",value:z.bio,onChange:K,placeholder:"Tell us a bit about yourself",rows:4,readOnly:!k})]}),B&&(0,t.jsx)("div",{className:"mb-4 text-red-600 font-semibold",children:B}),J&&(0,t.jsx)("div",{className:"mb-4 text-green-600 font-semibold",children:J}),(0,t.jsxs)("div",{className:"pt-4 flex flex-col gap-2",children:[(0,t.jsx)(i.$,{type:"button",variant:"outline",onClick:()=>L(e=>!e),children:H?"Cancel Password Change":"Change Password"}),H&&(0,t.jsxs)("div",{className:"space-y-4 mt-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(d.J,{htmlFor:"currentPassword",children:"Current Password"}),(0,t.jsx)(n.p,{id:"currentPassword",name:"currentPassword",type:"password",value:G,onChange:e=>V(e.target.value),required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.J,{htmlFor:"newPassword",children:"New Password"}),(0,t.jsx)(n.p,{id:"newPassword",name:"newPassword",type:"password",value:Q,onChange:e=>X(e.target.value),required:!0,minLength:6})]}),Y&&(0,t.jsx)("div",{className:"text-red-600",children:Y}),ee&&(0,t.jsx)("div",{className:"text-green-600",children:ee}),(0,t.jsx)(i.$,{onClick:el,disabled:es,type:"button",children:es?"Updating...":"Update Password"})]})]}),(0,t.jsxs)("div",{className:"pt-4 flex justify-end space-x-4",children:[k&&(0,t.jsx)(i.$,{type:"button",variant:"outline",onClick:()=>S(!1),children:"Cancel"}),(0,t.jsx)(i.$,{type:"submit",disabled:R,children:R?"Saving...":k?"Save Changes":"Edit"}),(0,t.jsx)(i.$,{type:"button",variant:"destructive",className:"ml-2 bg-red-600 text-white hover:bg-red-700",onClick:async()=>{if(window.confirm("Are you sure you want to delete your account? This action cannot be undone.")){I(!0),T(null);try{let a=j.j.currentUser;if(!a)throw Error("No authenticated user");await (0,w.hG)(a),e.push("/signup")}catch(e){T((null==e?void 0:e.message)||"Failed to delete account. Please try again.")}finally{I(!1)}}},disabled:R,children:"Delete Account"})]})]})]})})]}),a&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:()=>s(!1)}),E&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-md flex flex-col items-center",children:[(0,t.jsx)("span",{className:"mb-4 text-lg font-semibold",children:"Uploading Avatar..."}),(0,t.jsx)(i.$,{onClick:()=>q(!1),variant:"outline",children:"Cancel"})]})})]})}s(333)},9949:(e,a,s)=>{"use strict";s.d(a,{db:()=>d,j:()=>n});var t=s(9904),r=s(399),l=s(7058);let i=(0,t.Wp)({apiKey:"AIzaSyB6LYkEpOGtaAsEr3biosqd_QC3YSud9cw",authDomain:"fwrp-11fc3.firebaseapp.com",projectId:"fwrp-11fc3",storageBucket:"fwrp-11fc3.firebasestorage.app",messagingSenderId:"707085459051",appId:"1:707085459051:web:94dfad19e1e5b22b479b2e",measurementId:"G-K083R1WZWC"}),n=(0,r.xI)(i),d=(0,l.aU)(i)},5055:(e,a,s)=>{"use strict";s.d(a,{BK:()=>d,eu:()=>n,q5:()=>o});var t=s(5155),r=s(2115),l=s(2219),i=s(1567);let n=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.bL,{ref:a,className:(0,i.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...r})});n.displayName=l.bL.displayName;let d=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l._V,{ref:a,className:(0,i.cn)("aspect-square h-full w-full",s),...r})});d.displayName=l._V.displayName;let o=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.H4,{ref:a,className:(0,i.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...r})});o.displayName=l.H4.displayName},3312:(e,a,s)=>{"use strict";s.d(a,{$:()=>o});var t=s(5155),r=s(2115),l=s(1290),i=s(1027),n=s(1567);let d=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=r.forwardRef((e,a)=>{let{className:s,variant:r,size:i,asChild:o=!1,...c}=e,u=o?l.DX:"button";return(0,t.jsx)(u,{className:(0,n.cn)(d({variant:r,size:i,className:s})),ref:a,...c})});o.displayName="Button"},3900:(e,a,s)=>{"use strict";s.d(a,{p:()=>i});var t=s(5155),r=s(2115),l=s(1567);let i=r.forwardRef((e,a)=>{let{className:s,type:r,...i}=e;return(0,t.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:a,...i})});i.displayName="Input"},8986:(e,a,s)=>{"use strict";s.d(a,{J:()=>o});var t=s(5155),r=s(2115),l=s(6195),i=s(1027),n=s(1567);let d=(0,i.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.b,{ref:a,className:(0,n.cn)(d(),s),...r})});o.displayName=l.b.displayName},6754:(e,a,s)=>{"use strict";s.d(a,{T:()=>i});var t=s(5155),r=s(2115),l=s(1567);let i=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:a,...r})});i.displayName="Textarea"},1567:(e,a,s)=>{"use strict";s.d(a,{cn:()=>l});var t=s(3463),r=s(9795);function l(){for(var e=arguments.length,a=Array(e),s=0;s<e;s++)a[s]=arguments[s];return(0,r.QP)((0,t.$)(a))}}},e=>{var a=a=>e(e.s=a);e.O(0,[992,446,173,344,590,441,517,358],()=>a(3385)),_N_E=e.O()}]);