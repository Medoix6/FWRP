(()=>{var e={};e.id=942,e.ids=[942],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55511:e=>{"use strict";e.exports=require("crypto")},29021:e=>{"use strict";e.exports=require("fs")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},33873:e=>{"use strict";e.exports=require("path")},11723:e=>{"use strict";e.exports=require("querystring")},27910:e=>{"use strict";e.exports=require("stream")},79551:e=>{"use strict";e.exports=require("url")},9801:e=>{"use strict";e.exports=import("firebase-admin/app")},7879:e=>{"use strict";e.exports=import("firebase-admin/firestore")},71694:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{patchFetch:()=>p,routeModule:()=>u,serverHooks:()=>f,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>l});var o=r(42706),a=r(28203),i=r(45994),n=r(29847),c=e([n]);n=(c.then?(await c)():c)[0];let u=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/donated-food/route",pathname:"/api/donated-food",filename:"route",bundlePath:"app/api/donated-food/route"},resolvedPagePath:"D:\\FWRP\\src\\app\\api\\donated-food\\route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:d,workUnitAsyncStorage:l,serverHooks:f}=u;function p(){return(0,i.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:l})}s()}catch(e){s(e)}})},96487:()=>{},78335:()=>{},29847:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{DELETE:()=>d,GET:()=>u,POST:()=>p});var o=r(39187),a=r(7879),i=r(9801),n=r(97873),c=e([a,i]);[a,i]=c.then?(await c)():c,(0,i.getApps)().length||(0,i.initializeApp)({credential:(0,i.cert)({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n")})}),n.v2.config({cloud_name:process.env.CLOUDINARY_CLOUD_NAME,api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET});let l=(0,a.getFirestore)();async function p(e){try{let t=await e.formData(),r=t.get("foodName"),s=t.get("description"),a=t.get("location"),i=t.get("image"),c=t.get("userId"),p=t.get("expiryDate"),u=t.get("pickupInstructions");if(!r||!s||!a||!i||!c)return o.NextResponse.json({error:"Missing required fields"},{status:400});let d="";if("object"==typeof i&&"arrayBuffer"in i){let e=Buffer.from(await i.arrayBuffer());await new Promise((t,r)=>{n.v2.uploader.upload_stream({folder:"donated_food"},(e,s)=>{if(e)return r(e);d=s?.secure_url||"",t(s)}).end(e)})}let f="";try{let e=await l.collection("users").doc(c.toString()).get(),t=e.exists?e.data():void 0;t&&t.avatar&&(f=t.avatar)}catch{}let x=await l.collection("donated_food").add({foodName:r,description:s,location:a,expiryDate:p,pickupInstructions:u,imageUrl:d,userId:c,avatar:f,createdAt:new Date().toISOString()});return o.NextResponse.json({success:!0,id:x.id})}catch(t){let e="Server error";return t&&"object"==typeof t&&"message"in t&&(e=t.message??"Server error"),o.NextResponse.json({error:e},{status:500})}}async function u(){try{let e=(await l.collection("donated_food").orderBy("createdAt","desc").get()).docs.map(e=>({id:e.id,...e.data()}));return o.NextResponse.json({donations:e})}catch(t){let e="Server error";return t&&"object"==typeof t&&"message"in t&&(e=t.message??"Server error"),o.NextResponse.json({error:e},{status:500})}}async function d(e){try{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return o.NextResponse.json({error:"Missing donation id"},{status:400});return await l.collection("donated_food").doc(r).delete(),o.NextResponse.json({success:!0})}catch(t){let e="Server error";return t&&"object"==typeof t&&"message"in t&&(e=t.message??"Server error"),o.NextResponse.json({error:e},{status:500})}}s()}catch(e){s(e)}})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,71,873],()=>r(71694));module.exports=s})();